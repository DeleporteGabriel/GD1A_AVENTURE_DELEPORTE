<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>Mon 1er jeu Phaser</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js">
    </script>

    <style type="text/css"> body 
    
        { margin: 0; }
    
    </style>
</head>
<body>
<script type="text/javascript">

class scene1 extends Phaser.Scene{
    constructor(){
        super("scene1");
    }

    preload(){
        //this.load.image("Phaser_tuilesdejeu", "assets/tuilesJeu.png");

        this.load.tilemapTiledJSON("carte", "assets/tiled level/background_test.json");  

        this.load.image('hero', 'assets/test_png.png');
        this.load.spritesheet('heroDownWalk', 'assets/Fusette_down_walk.png',
        { frameWidth: 32, frameHeight: 32 });
        this.load.image('map', 'assets/map_test.jpg');

        this.load.tilemapTiledJSON("Background", 'assets/tiled level/background_test.json');
        this.load.image("Phaser_tuilesdejeu", 'assets/tiled level/background tiles.png');

    }

    create(){
        this.add.image(400, 300, 'map');
        /*
        //CARTE DU NIVEAU
        const carteDuNiveau = this.add.tilemap("Background");

            // importer TileSet 
            const tileset = carteDuNiveau.addTilesetImage(
                    "background",
                    "Phaser_tuilesdejeu"
                    );                    

            // importer les calques 
            const fond = carteDuNiveau.createStaticLayer(
                    "fond",
                    tileset
                    );
            const blocs = carteDuNiveau.createStaticLayer(
                    "blocs",
                    tileset
                    );*/

                    //TEST TILES
            const carteDuNiveau = this.add.tilemap("carte");

            // importer TileSet 
            const tileset = carteDuNiveau.addTilesetImage(
                    "background",
                    "Phaser_tuilesdejeu"
                    );                    

            // importer les calques 
            const fond = carteDuNiveau.createStaticLayer(
                    "fond",
                    tileset
                    );
            const décor_background = carteDuNiveau.createStaticLayer(
                    "blocs",
                    tileset
                    ); 

        //PERSONNAGE
        this.player = this.physics.add.sprite(160, 90, 'hero');

        this.anims.create({
                key: 'FusetteWalkDown',
                frames: this.anims.generateFrameNumbers('heroDownWalk', {start:0,end:3}),
                frameRate: 10,
                repeat: -1
            });

        this.cursors = this.input.keyboard.createCursorKeys();

        //CAMERA
        //this.cameras.main.zoom = 2;

        //this.physics.world.setBounds(0, 0, 5760, 1080);
        this.cameras.main.setBounds(0, 0, 5760, 1080);
        this.cameras.main.startFollow(this.player);  
    }

    update(){
        //Déplacement vertical
        if (this.cursors.up.isDown){
            if (this.cursors.down.isDown) {
                this.player.setVelocityY(0);
            }
            else {
                if (this.player.body.velocity.x != 0) {
                    this.player.setVelocityY(-100);
                } else {
                    this.player.setVelocityY(-150);
                }
            }
        }
        else if (this.cursors.down.isDown){
            if (this.player.body.velocity.x != 0) {
                    this.player.setVelocityY(100);
                } else {
                    this.player.setVelocityY(150);
                }
        }
        else {this.player.setVelocityY(0);}
        //Déplacement horizontal
        if (this.cursors.left.isDown){
            if (this.cursors.right.isDown) {
                this.player.setVelocityX(0);
            }
            else {
                if (this.player.body.velocity.y != 0) {
                    this.player.setVelocityX(-100);
                } else {
                    this.player.setVelocityX(-150);
                }
            }
        }
        else if (this.cursors.right.isDown){
            if (this.player.body.velocity.y != 0) {
                    this.player.setVelocityX(100);
                } else {
                    this.player.setVelocityX(150);
                }
        }
        else {this.player.setVelocityX(0);}

        if (this.player.body.velocity.y > 0) {
            if (this.player.body.velocity.x == 0)
            {
                this.player.anims.play('FusetteWalkDown', true);
            }
        }


    }
};

var config = {
        type: Phaser.AUTO,
        width: 960, height: 540,
        physics: {
        default: 'arcade',
        arcade: {
        debug: false
        }},
        scene: [scene1]
        };

        new Phaser.Game(config);

</script>
</body>
    
</html>